# Product Requirements Document (PRD)
# Storyteller NPCs - AI-Powered Minecraft Characters

**Version:** 1.0  
**Last Updated:** January 2025  
**Author:** [Your Name]  
**Status:** Draft

---

## 1. Executive Summary

### 1.1 Vision
Create immersive, AI-powered NPCs for Minecraft that can engage players in dynamic conversations, tell stories, provide adventure hints, and maintain persistent personalities with hidden depths - transforming passive gameplay into interactive narrative experiences.

### 1.2 Problem Statement
Current Minecraft NPCs (villagers, wandering traders) offer minimal interaction - just trading interfaces. Players seeking richer storytelling and guidance must rely on external wikis or mods with scripted dialogue. There's no way to have natural, contextual conversations with in-game characters.

### 1.3 Solution
A mod that adds Storyteller NPCs powered by Large Language Models (LLMs). These characters:
- Respond naturally to player questions and comments
- Maintain consistent personalities across conversations
- Are aware of the game world (biome, time, weather)
- Have hidden agendas that slowly reveal over time
- Work offline with local LLMs (Ollama) or optionally with cloud APIs

### 1.4 Success Metrics
| Metric | Target |
|--------|--------|
| Response latency (Ollama) | < 5 seconds for 7B model |
| Character consistency | Players report NPC stays "in character" >90% of time |
| Conversation depth | Average 10+ exchanges per session |
| Player retention | Players return to same NPC multiple times |

---

## 2. Target Users

### 2.1 Primary Users

**Singleplayer Storytellers**
- Play Minecraft for exploration and adventure
- Enjoy RPG elements and world-building
- Want guidance without breaking immersion
- Comfortable running local software (Ollama)

**Small Server Operators**
- Run private servers for friends/family
- Want to add unique experiences
- Technical enough to configure mods
- May have dedicated server hardware

### 2.2 Secondary Users

**Content Creators**
- Streamers/YouTubers creating narrative content
- Need memorable, quotable NPC interactions
- Value unique moments over scripted content

**Modpack Developers**
- Creating adventure/RPG modpacks
- Need configurable NPCs for custom stories
- Want integration with other mods

### 2.3 User Personas

#### Persona 1: "Adventure Alex"
- Age: 16-25
- Plays Minecraft 10+ hours/week
- Loves exploration, builds bases, fights bosses
- Wants hints without spoilers
- Has mid-range gaming PC
- **Need:** An NPC that gives cryptic clues about nearby structures/treasures

#### Persona 2: "Builder Beth"
- Age: 25-40
- Creative/survival hybrid player
- Enjoys Minecraft's peaceful moments
- Wants companionship and storytelling
- **Need:** An NPC that tells stories and remembers her projects

#### Persona 3: "Server Sam"
- Age: 20-35
- Runs a small SMP server
- Wants unique server identity
- Technical background
- **Need:** Custom NPCs that fit server lore, work for all players

---

## 3. Features & Requirements

### 3.1 Core Features (MVP)

#### F1: AI-Powered Conversations
**Priority:** P0 (Must Have)

| Requirement | Description |
|-------------|-------------|
| F1.1 | NPCs respond to free-form player text input |
| F1.2 | Responses generated by LLM (Ollama/Claude/OpenAI) |
| F1.3 | Response time < 10 seconds on recommended hardware |
| F1.4 | Graceful handling of LLM unavailability |
| F1.5 | Conversation history maintained per player |

#### F2: Character System
**Priority:** P0 (Must Have)

| Requirement | Description |
|-------------|-------------|
| F2.1 | Characters defined via JSON configuration |
| F2.2 | Personality traits influence responses |
| F2.3 | Backstory provides consistent history |
| F2.4 | Speech patterns (vocabulary, phrases) customizable |
| F2.5 | Multiple characters can coexist |

#### F3: Hidden Agenda System
**Priority:** P0 (Must Have)

| Requirement | Description |
|-------------|-------------|
| F3.1 | Characters have secret motivations |
| F3.2 | Short-term and long-term goals defined |
| F3.3 | Secrets gradually revealed based on conditions |
| F3.4 | Reveal conditions configurable (conversation count, triggers) |

#### F4: World Awareness
**Priority:** P1 (Should Have)

| Requirement | Description |
|-------------|-------------|
| F4.1 | NPCs know current biome |
| F4.2 | NPCs aware of time of day |
| F4.3 | NPCs react to weather |
| F4.4 | NPCs notice player health/hunger |
| F4.5 | NPCs can reference nearby structures (future) |

#### F5: Custom Skins
**Priority:** P1 (Should Have)

| Requirement | Description |
|-------------|-------------|
| F5.1 | NPCs use player model (humanoid) |
| F5.2 | Custom skins loaded from config folder |
| F5.3 | Support for slim (Alex) and wide (Steve) models |
| F5.4 | Default skin fallback when custom unavailable |

#### F6: LLM Provider Abstraction
**Priority:** P0 (Must Have)

| Requirement | Description |
|-------------|-------------|
| F6.1 | Support Ollama (local, default) |
| F6.2 | Support Claude API (optional) |
| F6.3 | Support OpenAI API (optional) |
| F6.4 | Provider switchable via config |
| F6.5 | Automatic fallback if primary fails |

### 3.2 Extended Features (Post-MVP)

#### F7: Eira Relay Integration
**Priority:** P1 (Should Have)

| Requirement | Description |
|-------------|-------------|
| F7.1 | Detect redstone signals from Eira HTTP Receiver blocks |
| F7.2 | NPCs react to external events (physical world triggers) |
| F7.3 | NPCs emit redstone for Eira HTTP Sender blocks |
| F7.4 | Webhook callbacks for story events |
| F7.5 | Configurable event-to-action mappings |
| F7.6 | Support multiple event patterns (pulse, fade, SOS) |

#### F8: Multi-Loader Support
**Priority:** P2 (Nice to Have)

| Requirement | Description |
|-------------|-------------|
| F7.1 | Fabric version |
| F7.2 | Forge (legacy) version |
| F7.3 | Shared codebase where possible |

#### F8: Quest Integration
**Priority:** P2 (Nice to Have)

| Requirement | Description |
|-------------|-------------|
| F8.1 | NPCs can give simple quests |
| F8.2 | Track quest completion |
| F8.3 | Rewards for completion |

#### F9: Voice Synthesis
**Priority:** P3 (Future)

| Requirement | Description |
|-------------|-------------|
| F9.1 | Text-to-speech for NPC responses |
| F9.2 | Character-specific voices |
| F9.3 | Local TTS option |

#### F10: NPC-to-NPC Interaction
**Priority:** P3 (Future)

| Requirement | Description |
|-------------|-------------|
| F10.1 | NPCs can converse with each other |
| F10.2 | Players can observe conversations |
| F10.3 | NPCs form relationships |

---

## 4. Technical Requirements

### 4.1 Platform Support

| Platform | Version | Priority |
|----------|---------|----------|
| Minecraft | 1.21.4 | P0 |
| NeoForge | 21.4.x | P0 |
| Fabric | 0.100+ | P2 |
| Forge | 1.20.x | P2 |
| Java | 21+ | P0 |

### 4.2 LLM Requirements

| Provider | Min Model | Recommended |
|----------|-----------|-------------|
| Ollama | llama3.2:3b | mistral:7b-instruct |
| Claude | claude-3-haiku | claude-sonnet-4-20250514 |
| OpenAI | gpt-4o-mini | gpt-4o |

### 4.3 Hardware Requirements (Client/Singleplayer with Ollama)

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| RAM | 16 GB | 32 GB |
| VRAM | 4 GB | 8 GB |
| Storage | 10 GB free | 20 GB free |
| CPU | 4 cores | 8 cores |

### 4.4 Performance Targets

| Metric | Target |
|--------|--------|
| Memory overhead | < 100 MB |
| TPS impact | < 1 TPS loss |
| Network packets | < 10 KB per exchange |
| Concurrent conversations | 10+ per server |

---

## 5. User Experience

### 5.1 Interaction Flow

```
┌─────────────────────────────────────────────────────────────┐
│  1. Player finds/spawns NPC in world                        │
├─────────────────────────────────────────────────────────────┤
│  2. Player right-clicks NPC                                 │
├─────────────────────────────────────────────────────────────┤
│  3. Chat screen opens with NPC greeting                     │
├─────────────────────────────────────────────────────────────┤
│  4. Player types message, presses Enter                     │
├─────────────────────────────────────────────────────────────┤
│  5. "Thinking..." indicator shows                           │
├─────────────────────────────────────────────────────────────┤
│  6. NPC response appears in chat window                     │
├─────────────────────────────────────────────────────────────┤
│  7. Conversation continues until player closes (Escape)     │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 Chat Interface Requirements

- Clean, readable text display
- Clear distinction between player and NPC messages
- Scrollable history
- Input field with 500 character limit
- Send button + Enter key support
- Escape to close
- Non-pausing (singleplayer continues in background)

### 5.3 Visual Feedback

| State | Indicator |
|-------|-----------|
| NPC idle | Subtle breathing animation |
| NPC thinking | Particle effect (enchantment-like) |
| NPC talking | Chat bubble / name highlight |
| NPC unavailable | Greyed name, error message |

---

## 6. Configuration

### 6.1 Config File Structure

```
config/storyteller/
├── storyteller-common.toml      # Server/LLM settings
├── storyteller-client.toml      # Client display settings
├── characters/
│   ├── eldric.json              # Default character
│   └── [custom].json            # User characters
└── skins/
    ├── README.txt
    └── [custom].png             # User skins
```

### 6.2 Key Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `llm.provider` | enum | OLLAMA | Active LLM provider |
| `ollama.endpoint` | string | localhost:11434 | Ollama API URL |
| `ollama.model` | string | mistral:7b-instruct | Model to use |
| `npc.maxHistory` | int | 20 | Messages to remember |
| `npc.worldContext` | bool | true | Include world info |
| `ratelimit.minTime` | int | 20 | Ticks between messages |

---

## 7. Risks & Mitigations

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| LLM generates inappropriate content | High | Medium | System prompt guardrails, content filtering |
| Slow response times frustrate users | Medium | Medium | Async processing, thinking indicators, smaller models |
| Character breaks roleplay | Medium | Medium | Strong system prompts, "avoid phrases" config |
| Memory/performance issues | High | Low | Efficient history management, lazy loading |
| API costs (Claude/OpenAI) | Medium | Medium | Local-first default, rate limiting, usage warnings |
| Mod conflicts | Low | Medium | Minimal mixins, standard NeoForge patterns |

---

## 8. Timeline

### Phase 1: MVP (4-6 weeks)
- [x] Project setup, build system
- [ ] Core entity and rendering
- [ ] Ollama integration
- [ ] Basic chat UI
- [ ] Character JSON loading
- [ ] Simple world context

### Phase 2: Polish (2-3 weeks)
- [ ] Claude/OpenAI providers
- [ ] Custom skin loading
- [ ] Commands and admin tools
- [ ] Configuration UI (optional)
- [ ] Testing and bug fixes

### Phase 3: Multi-Loader (3-4 weeks)
- [ ] Abstract platform code
- [ ] Fabric port
- [ ] Forge port
- [ ] Unified release process

### Phase 4: Extended Features (Ongoing)
- [ ] Quest system
- [ ] Voice synthesis
- [ ] NPC relationships
- [ ] Community feedback features

---

## 9. Open Questions

1. **Persistence:** Should conversation history persist across server restarts?
2. **Multiplayer:** How to handle multiple players talking to same NPC simultaneously?
3. **Moderation:** Should server ops be able to view/moderate conversations?
4. **Localization:** Support for non-English characters/players?
5. **Integration:** APIs for other mods to interact with Storyteller NPCs?

---

## 10. Appendix

### A. Competitive Analysis

| Mod/Tool | Strengths | Weaknesses |
|----------|-----------|------------|
| Custom NPCs | Visual editor, quests | Scripted only, no AI |
| Taterzens | Fabric support, skins | No dialogue system |
| MineColonies | Deep NPC system | Not narrative focused |
| ChatGPT (external) | Powerful AI | Breaks immersion, no game context |

### B. References

- [Ollama Documentation](https://github.com/ollama/ollama)
- [Anthropic Claude API](https://docs.anthropic.com/)
- [NeoForge Documentation](https://docs.neoforged.net/)
- [Minecraft Wiki - Entity Data](https://minecraft.wiki/w/Entity_format)
